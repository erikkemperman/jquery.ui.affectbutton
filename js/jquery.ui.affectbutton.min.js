/*! jquery.ui.affectbutton 2014-12-28 */

!function(a,b){var c=8,d=9,e=[1.7,0,0,0,0,0,0,0,0,-.5,0,1,1.3,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,1.3,-1,-1,1,-.3,0,0,-1,-1,-.5,-.5,1,1.3,-1,1,-1,1,1,-.8,.8,0,0,-.3,.5,1.3,-1,1,1,.5,0,.8,-.8,1,1,-1,1,1.3,1,-1,-1,-1,-1,0,0,0,-1,.7,1,1.3,1,-1,1,-.5,0,0,0,0,-.5,1,1,1.3,1,1,-1,.3,1,0,0,-1.5,.7,.5,-.5,1.3,1,1,1,.5,.5,0,0,1,.5,1,.5];a.widget("ui.affectbutton",{options:{active:!0,drag:"undefined"!=typeof a.mobile,offset:0,interval:40,sensitivity:1.1,sigmoidSteepness:11,sigmoidZero:8.5,swapAD:!1,cursor:"crosshair",lineCap:"round",scaleMin:10,scaleMax:370,padding:2,ground:{fill0:"#534",fill1:"#756",stroke:"#645",width:1},face:{fill0:"#fdb",fill1:"#eb0",stroke:"#fc3",width:1,shadow:"#312",shadowX:2,shadowY:3},brow:{stroke:"#000",width:1,shadow:"#ca6",shadowX:.75,shadowY:1.5},eye:{fill0:"#fff",stroke:"#aaa",width:.5},iris:{fill0:"#aed",fill1:"#adf",stroke:"#48c",width:.5},pupil:{fill0:"#000"},mouth:{fill0:"#200",fill1:"#700",stroke:"#f55",width:.5},teeth:{fill0:"#fff",shadow:"#ddd",stroke:"#ccc",width:.5,grid:[.1,.25,.5,.75,.9]}},_create:function(){var b=this.options.offset*(4+c),d=this.element;a.extend(this,{state:{pleasure:e[b+1],arousal:e[b+2],dominance:e[b+3]},feats:e.slice(b+4,b+4+c),width:0,height:0,active:this.options.active,repaint:!0,down:!1}),d.css("cursor",this.options.cursor),a.each(this._eventMap(),function(b,c){"undefined"==typeof a.mobile||"mousedown"!==b&&"mousemove"!==b&&"mouseup"!==b||(b="v"+b),d.on(b+".ui-affectbutton",c)})},_init:function(){this.active?(this.active=!1,this.alive(!0)):(this.repaint=!0,this._paint())},destroy:function(){this.element.off(".ui-affectbutton")},alive:function(a){return 0===arguments.length?this.active:(a=!!a,void(a!==this.active&&(this.active=a,a?(this.repaint=!0,this._paint()):b.clearTimeout(this.timer))))},affect:function(b,c){var d=this;switch(arguments.length){case 0:return a.extend({},this.state);case 1:a.each(b,function(a,b){d.affect(a,b)});break;case 2:d.state.hasOwnProperty(b)&&!isNaN(c=parseFloat(c))&&(d.state[b]=d._clip(c));break;default:throw"too many args"}this.repaint=!0,this.active||this._paint()},reset:function(){this.mouseX=this.mouseY=0,this.affect({pleasure:0,arousal:0,dominance:0})},_eventMap:function(){var a=this;return{selectstart:!1,mouseenter:function(){return a.down=!1,a.clicked=!1,!1},mouseleave:function(){return a.down=!1,a.clicked=!1,!1},mousedown:function(b){return a.down=!0,a.clicked=!1,a._doMouse(b),!1},mousemove:function(b){return a.clicked=!1,a._doMouse(b),!1},mouseup:function(b){return a.down&&(a.clicked=!0),a.down=!1,a._doMouse(b),!1}}},_doMouse:function(a){var b;!this.active||!this.down&&this.options.drag||(b=this.element.offset(),this.mouseX=a.pageX-b.left,this.mouseY=a.pageY-b.top,this._setXY(2*this.mouseX/(this.width-1)-1,1-2*this.mouseY/(this.height-1)),(this.clicked||this.down)&&this.element.trigger("affectchanged",[this.affect()]))},_setXY:function(a,b){var c=this.options.sensitivity*a,d=this.options.sensitivity*b,e=Math.max(Math.abs(c),Math.abs(d)),f=2.1/(1+Math.exp(-(this.options.sigmoidSteepness*e-this.options.sigmoidZero)))-1;this.affect({pleasure:c,arousal:this.options.swapAD?d:f,dominance:this.options.swapAD?f:d})},_updateFeatures:function(){var a,b,f,g,h,i,j,k,l;for(a=0;c>a;a++)this.feats[a]=0;for(h=0,b=0;d>b;b++)if(f=b*(4+c),(i=e[f++])>0&&(j=Math.abs(this.state.pleasure-e[f++]))<i&&(k=Math.abs(this.state.arousal-e[f++]))<i&&(l=Math.abs(this.state.dominance-e[f++]))<i&&(g=Math.sqrt(j*j+k*k+l*l))<i){for(g=i-g,a=0;c>a;a++)this.feats[a]+=g*e[f++];h+=g}for(a=0;c>a;a++)this.feats[a]/=h},_paint:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(b=Date.now(),!(d=this.element.width())||!(e=this.element.height())||!this.element.is(":visible"))return void this._repaint(250);if(g=e>d?d:e,f=Math.max(1,this._scale(g,this.options.padding)),g=Math.max(g-2*f,0),n=Math.round((d-g)/2),o=Math.round((e-g)/2),(d!==this.width||e!==this.height)&&(c=this.element.get(0).getContext("2d"),a.extend(this,{size:g,width:d,height:e}),this._style(c,g,"ground",0,0,0,e),c.fillRect(0,0,d,e),c.strokeRect(0,0,d,e),this._face(c,g,d,e,n,o),this.backdrop=c.getImageData(0,0,d,e),this.repaint=!0),this.repaint){c=c||this.element.get(0).getContext("2d"),this.repaint=!1,c.putImageData(this.backdrop,0,0,0,0,d,e),this._updateFeatures(),h=g/4,i=g/12,j=g/2,k=g/6,l=this._clip((this.mouseX||d/2)-d/2,-d,d)/20,m=this._clip((this.mouseY||e/2)-e/2,-e,e)/20,p=l+n,q=o+g/10-(this.state.arousal+this.state.dominance)*g/20,t=h,u=i*(this.feats[0]+1)+1,r=p+.15*g,s=q+g/3-u/2,v=i*(this.feats[1]+1)/2+i/2+1,w=i*-this.feats[2]/2,x=i*-this.feats[3]/2,B=j*(this.feats[4]+1)/6+j/2,C=k*(this.feats[5]+1)/3,D=k*this.feats[6]/2,y=p+g/2-B/2,z=q+g*(2/3)-D,A=C-D,E=C+D,F=k*(this.feats[7]-1)/3;for(var G=0;2>G;G++)this._eye(c,g,r,s,t,u),c.save(),c.clip(),this._iris(c,g,l,m,r,s,t,u),this._pupil(c,g,l,m,r,s,t,u),c.restore(),this._brow(c,g,r,s,t,u,v,x,w,G),r=p+.6*g;this._mouth(c,g,y,z,B,A,E),c.fillStyle=this.options.teeth.shadow||this.options.teeth.fill0,c.fill(),c.save(),c.clip(),this.options.teeth.shadow&&(this._mouth(c,g,y+C/5,z+C/3,B,A,E),c.fillStyle=this.options.teeth.fill0,c.fill()),this._style(c,g,"teeth"),a.each(this.options.teeth.grid,function(a,b){c.beginPath(),c.moveTo(y+b*B,Math.min(z,z-A)),c.lineTo(y+b*B,Math.max(z,z+E)),c.closePath(),c.stroke()}),0===F?(c.moveTo(y,z+D),c.lineTo(y+B,z+D),c.stroke()):(this._style(c,g,"mouth",y+B/2,z+C,B/6,y+B/2,z+C/2,B/2),c.fillRect(y,z+D+F,B,-2*F)),c.restore(),this._mouth(c,g,y,z,B,A,E),this._style(c,g,"mouth"),c.stroke()}this.active&&this._repaint(this.options.interval-(Date.now()-b))},_repaint:function(a){var c=this;this.timer=b.setTimeout(function(){c._paint()},a)},_face:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(e,f+b/3),a.bezierCurveTo(e,f+b/7,e+b/6,f,c/2,f),a.bezierCurveTo(c-e-b/6,f,c-e,f+b/7,c-e,f+b/3),a.lineTo(c-e,d/2),a.bezierCurveTo(c-e,d-f-b/3,c-e-b/6,d-f,c/2,d-f),a.bezierCurveTo(e+b/6,d-f,e,d-f-b/3,e,d/2),a.lineTo(e,f+b/3),a.closePath(),this._style(a,b,"face",c/2-b/4,d/2-b/7,b/4,c/2,d/2,b),this._shadow(a,b,"face",!0),this._shadow(a),a.fill(),a.stroke()},_eye:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(c,d+f/2),a.bezierCurveTo(c,d+f/4,c+e/6,d,c+e/2,d),a.bezierCurveTo(c+e-e/6,d,c+e,d+f/4,c+e,d+f/2),a.bezierCurveTo(c+e,d+f-f/4,c+e-e/6,d+f,c+e/2,d+f),a.bezierCurveTo(c+e/6,d+f,c,d+f-f/4,c,d+f/2),a.closePath(),this._style(a,b,"eye"),a.fill(),a.stroke()},_iris:function(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(c+e+g/2,d+f+h/2,g/4,0,2*Math.PI),a.closePath(),this._style(a,b,"iris",c+e+g/2,d+f+h/2,g/10,c+e+g/2,d+f+h/2,g/4),a.fill(),a.stroke()},_pupil:function(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(c+e+g/2,d+f+h/2,g/10,0,2*Math.PI),a.closePath(),this._style(a,b,"pupil"),a.fill(),a.stroke()},_brow:function(a,b,c,d,e,f,g,h,i,j){a.beginPath(),a.moveTo(c,d+f/2-g+(j?h:i)-(h-i)/8),a.lineTo(c+e,d+f/2-g+(j?i:h)),a.closePath(),this._shadow(a,b,"brow"),this._style(a,b,"brow"),a.stroke(),this._shadow(a)},_mouth:function(a,b,c,d,e,f,g){a.beginPath(),a.moveTo(c,d),a.bezierCurveTo(c,d-f/2,c+e/4,d-f,c+e/2,d-f),a.bezierCurveTo(c+e-e/4,d-f,c+e,d-f/2,c+e,d),a.bezierCurveTo(c+e,d+g/2,c+e-e/4,d+g,c+e/2,d+g),a.bezierCurveTo(c+e/4,d+g,c,d+g/2,c,d),a.closePath()},_shadow:function(a,b,c,d){1===arguments.length?(a.shadowColor="",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0):(a.shadowColor=this.options[c].shadow,a.shadowOffsetX=this._scale(b,this.options[c].shadowX),a.shadowOffsetY=this._scale(b,this.options[c].shadowY),a.shadowBlur=d?a.shadowOffsetX+a.shadowOffsetY:0)},_style:function(a,b,c){var d,e=this.options[c].fill0,f=this.options[c].fill1||e;a.lineWidth=this._scale(b,this.options[c].width),a.strokeStyle=this.options[c].stroke,arguments.length>3&&e!==f?(d=a["create"+(arguments.length>7?"Radial":"Linear")+"Gradient"].apply(a,Array.prototype.slice.call(arguments,3)),d.addColorStop(0,e),d.addColorStop(1,f)):d=e,a.fillStyle=d},_scale:function(a,b){return s=this._clip(a,this.options.scaleMin,this.options.scaleMax),b*a/100},_clip:function(a,b,c){return b=b||-1,c=c||1,b>a?b:a>c?c:a}})}(jQuery,this);
//# sourceMappingURL=jquery.ui.affectbutton.min.js.map