/*! jquery.ui.affectbutton 2014-12-29 */

!function(a,b){var c=8,d=9,e=[1.7,0,0,0,0,0,0,0,0,-.5,0,1,1.3,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,1.3,-1,-1,1,-.3,0,0,-1,-1,-.5,-.5,1,1.3,-1,1,-1,1,1,-.8,.8,0,0,-.3,.5,1.3,-1,1,1,.5,0,.8,-.8,1,1,-1,1,1.3,1,-1,-1,-1,-1,0,0,0,-1,.7,1,1.3,1,-1,1,-.5,0,0,0,0,-.5,1,1,1.3,1,1,-1,.3,1,0,0,-1.5,.7,.5,-.5,1.3,1,1,1,.5,.5,0,0,1,.5,1,.5];STYLE_DEFAULTS={ground:{fill0:"#edfeff",fill1:"#cbdcff",stroke:"#45609c",width:1},face:{fill0:"#ffc800",fill1:"",stroke:"#f0c030",width:1,shadow:"#301020",shadowX:0,shadowY:0},brow:{stroke:"#000000",width:3,shadow:"#c0a060",shadowX:0,shadowY:0},eye:{fill0:"#ffffff",stroke:"#ffffff",width:.1},iris:{fill0:"#00c8c8",fill1:"",stroke:"#00c8c8",width:.5},pupil:{fill0:"#000000",stroke:"#00ffff",width:.25},mouth:{fill0:"#ffc800",fill1:"",stroke:"#c86400",width:1},teeth:{fill0:"#ffffff",shadow:"",stroke:"#ffc800",width:1,grid:[.1,.25,.5,.75,.9]}},a.widget("ui.affectbutton",{options:{active:!0,drag:"undefined"!=typeof a.mobile,offset:0,interval:40,sensitivity:1.1,sigmoidSteepness:11,sigmoidZero:8.5,swapAD:!1,smoothing:!0,cursor:"crosshair",lineCap:"round",scaleMin:10,scaleMax:370,padding:3,style:STYLE_DEFAULTS},_create:function(){var b=this.options.offset*(4+c),d=this.element,f=this;if(a.extend(f,{state:{pleasure:e[b+1],arousal:e[b+2],dominance:e[b+3]},features:e.slice(b+4,b+4+c),width:0,height:0,active:f.options.active,repaint:!0,down:!1,context:d.get(0).getContext("2d")}),this.context.imageSmoothingEnabled=f.options.smoothing,d.css("cursor",f.options.cursor),"string"==typeof this.options.style){var g=d.is(":visible");g&&d.hide(),a.getJSON(f.options.style,function(b){a.extend(f.options.style,b),g&&d.show()}),f.options.style=STYLE_DEFAULTS}a.each(this._eventMap(),function(b,c){"undefined"==typeof a.mobile||"mousedown"!==b&&"mousemove"!==b&&"mouseup"!==b||(b="v"+b),d.on(b+".ui-affectbutton",c)})},_init:function(){this.active?(this.active=!1,this.alive(!0)):(this.repaint=!0,this._paint())},destroy:function(){this.element.off(".ui-affectbutton"),b.clearTimeout(this.timer)},alive:function(a){return 0===arguments.length?this.active:(a=!!a,void(a!==this.active&&(this.active=a,a?(this.repaint=!0,this._paint()):b.clearTimeout(this.timer))))},affect:function(b,c){var d=this;switch(arguments.length){case 0:return a.extend({},this.state);case 1:a.each(b,function(a,b){d.affect(a,b)});break;case 2:d.state.hasOwnProperty(b)&&!isNaN(c=parseFloat(c))&&(d.state[b]=d._clip(c));break;default:throw"too many args"}this.repaint=!0,this.active||this._paint()},reset:function(){this.mouseX=this.mouseY=0,this.affect({pleasure:0,arousal:0,dominance:0})},_eventMap:function(){var a=this;return{selectstart:!1,mouseenter:function(){return a.down=!1,!1},mouseleave:function(){return a.down=!1,!1},mousedown:function(b){return a.down=!0,a._doMouse(b),!1},mousemove:function(b){return a._doMouse(b),!1},mouseup:function(b){return a.down=!1,a._doMouse(b),!1}}},_doMouse:function(a){var b;!this.active||!this.down&&this.options.drag||(b=this.element.offset(),this.mouseX=a.pageX-b.left,this.mouseY=a.pageY-b.top,this._setXY(2*this.mouseX/(this.width-1)-1,1-2*this.mouseY/(this.height-1)),this.down&&this.element.trigger("affectchanged",[this.affect()]))},_setXY:function(a,b){var c=this.options.sensitivity*a,d=this.options.sensitivity*b,e=Math.max(Math.abs(c),Math.abs(d)),f=2.1/(1+Math.exp(-(this.options.sigmoidSteepness*e-this.options.sigmoidZero)))-1;this.affect({pleasure:c,arousal:this.options.swapAD?d:f,dominance:this.options.swapAD?f:d})},_updateFeatures:function(){var a,b,f,g,h,i,j,k,l;for(a=0;c>a;a++)this.features[a]=0;for(h=0,b=0;d>b;b++)if(f=b*(4+c),(i=e[f++])>0&&(j=Math.abs(this.state.pleasure-e[f++]))<i&&(k=Math.abs(this.state.arousal-e[f++]))<i&&(l=Math.abs(this.state.dominance-e[f++]))<i&&(g=Math.sqrt(j*j+k*k+l*l))<i){for(g=i-g,a=0;c>a;a++)this.features[a]+=g*e[f++];h+=g}for(a=0;c>a;a++)this.features[a]/=h},_paint:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this.context,B=Date.now(),C=this.element.width(),D=this.element.height(),E=Math.min(C,D),F=Math.max(1,this._scale(E,this.options.padding)),G=Math.max(E-2*F,0);if(!C||!D||!this.element.is(":visible"))return void this._repaint(250);if(h=Math.round((C-G)/2),i=Math.round((D-G)/2),(C!==this.width||D!==this.height)&&(a.extend(this,{size:G,width:C,height:D}),this.element.attr({width:this.element.attr("width")||C,height:this.element.attr("height")||D}),this._style(A,G,"ground",0,0,0,D),A.fillRect(0,0,C,D),A.strokeRect(0,0,C,D),this._face(A,G,C,D,h,i),this.backdrop=A.getImageData(0,0,C,D),this.repaint=!0),this.repaint){this.repaint=!1,A.putImageData(this.backdrop,0,0,0,0,C,D),this._updateFeatures(),b=G/4,c=G/12,d=G/2,e=G/6,f=this._clip((this.mouseX||C/2)-C/2,-C,C)/20,g=this._clip((this.mouseY||D/2)-D/2,-D,D)/20,j=f+h,k=i+G/10-(this.state.arousal+this.state.dominance)*G/20,n=b,o=c*(this.features[0]+1)+1,l=j+.15*G,m=k+G/3-o/2,p=c*(this.features[1]+1)/2+c/2+1,q=c*-this.features[2]/2,r=c*-this.features[3]/2,v=d*(this.features[4]+1)/6+d/2,w=e*(this.features[5]+1)/3,x=e*this.features[6]/2,s=j+G/2-v/2,t=k+G*(2/3)-x,u=w-x,y=w+x,z=e*(this.features[7]-1)/3;for(var H=0;2>H;H++)this._eye(A,G,l,m,n,o),A.save(),A.clip(),this._iris(A,G,f,g,l,m,n,o),this._pupil(A,G,f,g,l,m,n,o),A.restore(),this._brow(A,G,l,m,n,o,p,r,q,H),l=j+.6*G;this._mouth(A,G,s,t,v,u,y),A.fillStyle=this.options.style.teeth.shadow||this.options.style.teeth.fill0,A.fill(),A.save(),A.clip(),this.options.style.teeth.shadow&&(this._mouth(A,G,s+w/5,t+w/3,v,u,y),A.fillStyle=this.options.style.teeth.fill0,A.fill()),this._style(A,G,"teeth"),a.each(this.options.style.teeth.grid,function(a,b){A.beginPath(),A.moveTo(s+b*v,Math.min(t,t-u)),A.lineTo(s+b*v,Math.max(t,t+y)),A.closePath(),A.stroke()}),0===z?(A.moveTo(s,t+x),A.lineTo(s+v,t+x),A.stroke()):(this._style(A,G,"mouth",s+v/2,t+w,v/6,s+v/2,t+w/2,v/2),A.fillRect(s,t+x+z,v,-2*z)),A.restore(),this._mouth(A,G,s,t,v,u,y),this._style(A,G,"mouth"),A.stroke()}this.active&&this._repaint(this.options.interval-(Date.now()-B))},_repaint:function(a){var c=this;this.timer=b.setTimeout(function(){c._paint()},a)},_face:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(e,f+b/3),a.bezierCurveTo(e,f+b/7,e+b/6,f,c/2,f),a.bezierCurveTo(c-e-b/6,f,c-e,f+b/7,c-e,f+b/3),a.lineTo(c-e,d/2),a.bezierCurveTo(c-e,d-f-b/3,c-e-b/6,d-f,c/2,d-f),a.bezierCurveTo(e+b/6,d-f,e,d-f-b/3,e,d/2),a.lineTo(e,f+b/3),a.closePath(),this._style(a,b,"face",c/2-b/4,d/2-b/7,b/4,c/2,d/2,b),this._shadow(a,b,"face",!0),a.stroke(),this._shadow(a),a.fill()},_eye:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(c,d+f/2),a.bezierCurveTo(c,d+f/4,c+e/6,d,c+e/2,d),a.bezierCurveTo(c+e-e/6,d,c+e,d+f/4,c+e,d+f/2),a.bezierCurveTo(c+e,d+f-f/4,c+e-e/6,d+f,c+e/2,d+f),a.bezierCurveTo(c+e/6,d+f,c,d+f-f/4,c,d+f/2),a.closePath(),this._style(a,b,"eye"),a.fill(),a.stroke()},_iris:function(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(c+e+g/2,d+f+h/2,g/4,0,2*Math.PI),a.closePath(),this._style(a,b,"iris",c+e+g/2,d+f+h/2,g/10,c+e+g/2,d+f+h/2,g/4),a.fill(),a.stroke()},_pupil:function(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(c+e+g/2,d+f+h/2,g/10,0,2*Math.PI),a.closePath(),this._style(a,b,"pupil"),a.fill(),a.stroke()},_brow:function(a,b,c,d,e,f,g,h,i,j){a.beginPath(),a.moveTo(c,d+f/2-g+(j?h:i)-(h-i)/8),a.lineTo(c+e,d+f/2-g+(j?i:h)),a.closePath(),this._shadow(a,b,"brow",!0),this._style(a,b,"brow"),a.stroke(),this._shadow(a)},_mouth:function(a,b,c,d,e,f,g){a.beginPath(),a.moveTo(c,d),a.bezierCurveTo(c,d-f/2,c+e/4,d-f,c+e/2,d-f),a.bezierCurveTo(c+e-e/4,d-f,c+e,d-f/2,c+e,d),a.bezierCurveTo(c+e,d+g/2,c+e-e/4,d+g,c+e/2,d+g),a.bezierCurveTo(c+e/4,d+g,c,d+g/2,c,d),a.closePath()},_shadow:function(a,b,c,d){1===arguments.length?(a.shadowColor="",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0):(a.shadowColor=this.options.style[c].shadow,a.shadowOffsetX=this._scale(b,this.options.style[c].shadowX),a.shadowOffsetY=this._scale(b,this.options.style[c].shadowY),a.shadowBlur=d?a.shadowOffsetX+a.shadowOffsetY:0)},_style:function(a,b,c){var d,e=this.options.style[c].fill0,f=this.options.style[c].fill1||e;a.lineWidth=this._scale(b,this.options.style[c].width),a.strokeStyle=this.options.style[c].stroke,arguments.length>3&&e!==f?(d=a["create"+(arguments.length>7?"Radial":"Linear")+"Gradient"].apply(a,Array.prototype.slice.call(arguments,3)),d.addColorStop(0,e),d.addColorStop(1,f)):d=e,a.fillStyle=d},_scale:function(a,b){return a=this._clip(a,this.options.scaleMin,this.options.scaleMax),a*b/100},_clip:function(a,b,c){return b=b||-1,c=c||1,b>a?b:a>c?c:a}})}(jQuery,this);
//# sourceMappingURL=jquery.ui.affectbutton.min.js.map